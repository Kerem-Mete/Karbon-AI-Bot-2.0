import discord
from discord.ext import commands
from datetime import datetime

intents = discord.Intents.default()
intents.message_content = True
bot = commands.Bot(command_prefix="!", intents=intents)

user_data = {}
dil_tercihi = {}
kullanici_durumlari = {}

mesajlar = {
    "tr": {
        "tanitim": "Merhaba! Ben Kerem Salih Mete, 13 yaÅŸÄ±ndayÄ±m. Bu karbon ayak izi projesinin sahibiyim.",
        "sorular": [
            "ğŸš— GÃ¼nlÃ¼k kaÃ§ km araba kullanÄ±yorsun?",
            "ğŸ’¡ GÃ¼nlÃ¼k kaÃ§ kWh elektrik harcÄ±yorsun?",
            "ğŸš¿ GÃ¼nlÃ¼k kaÃ§ litre su harcÄ±yorsun?",
            "ğŸ¥© GÃ¼nlÃ¼k kaÃ§ gram et tÃ¼ketiyorsun?"
        ],
        "sonuc": "ğŸŒ **YÄ±llÄ±k Karbon Ayak Ä°zin:** {karbon:.2f} kg COâ‚‚\nğŸ“ **Yorum:**\n{yorum}",
        "yorumlar": [
            "Tebrikler! Karbon ayak iziniz dÃ¼ÅŸÃ¼k.",
            "Karbon ayak iziniz orta seviyede.",
            "Karbon ayak iziniz yÃ¼ksek, Ã§evreci seÃ§enekleri deneyin."
        ],
        "kayit_yok": "KayÄ±t bulunamadÄ±. Ã–nce !hesapla ile veri girmelisiniz.",
        "gecmis": "**{user} kullanÄ±cÄ±sÄ±nÄ±n geÃ§miÅŸ verileri:**\n",
        "veri": "- ğŸš— Araba: {araba} km\n- ğŸ’¡ Elektrik: {elektrik} kWh\n- ğŸš¿ Su: {su} litre\n- ğŸ¥© Et: {et} gram\nğŸ“… {tarih}",
        "karsilastirma_yok": "KarÅŸÄ±laÅŸtÄ±rmak iÃ§in en az 2 kayÄ±t gerekli. !hesapla ile veri girin.",
        "karsilastirma": "**Son iki kayÄ±t karÅŸÄ±laÅŸtÄ±rmasÄ±:**\nâ€¢ Eski: {eski} â€” {eski_karbon:.2f} kg COâ‚‚/yÄ±l\nâ€¢ Yeni: {yeni} â€” {yeni_karbon:.2f} kg COâ‚‚/yÄ±l\n\n{durum}",
        "durumlar": [
            "Karbon ayak izinizde deÄŸiÅŸiklik yok.",
            "Karbon ayak iziniz **arttÄ±**! (+{fark:.2f} kg COâ‚‚)",
            "Karbon ayak iziniz **azaldÄ±**! ({fark:.2f} kg COâ‚‚ tasarruf)"
        ],
        "temizlendi": "TÃ¼m verileriniz baÅŸarÄ±yla silindi.",
        "dil_degisti": "Dil TÃ¼rkÃ§e olarak ayarlandÄ±.",
        "gecersiz": "LÃ¼tfen geÃ§erli bir sayÄ± girin.",
        "tablo": "**Komut** | **AÃ§Ä±klama**\n--- | ---\n!tanitim | Botun yaratÄ±cÄ±sÄ±nÄ± tanÄ±tÄ±r\n!dil en/tr | Botun dilini deÄŸiÅŸtirir\n!hesapla | GÃ¼nlÃ¼k verilerinizi alÄ±r ve karbon hesabÄ± yapar\n!geÃ§miÅŸ | Ã–nceki kayÄ±tlarÄ± gÃ¶sterir\n!karÅŸÄ±laÅŸtÄ±r | Son iki kaydÄ± karÅŸÄ±laÅŸtÄ±rÄ±r\n!temizle | TÃ¼m kayÄ±tlarÄ± siler\n!komutlar | Komut listesini gÃ¶sterir"
    },
    "en": {
        "tanitim": "Hello! I'm Kerem Salih Mete, 13 years old. I created this carbon footprint project.",
        "sorular": [
            "ğŸš— How many km do you drive daily?",
            "ğŸ’¡ How many kWh electricity do you use daily?",
            "ğŸš¿ How many liters of water do you use daily?",
            "ğŸ¥© How many grams of meat do you consume daily?"
        ],
        "sonuc": "ğŸŒ **Your Annual Carbon Footprint:** {karbon:.2f} kg COâ‚‚\nğŸ“ **Comment:**\n{yorum}",
        "yorumlar": [
            "Congrats! Your carbon footprint is low.",
            "Your carbon footprint is moderate.",
            "Your carbon footprint is high, try greener habits."
        ],
        "kayit_yok": "No records found. Please use !hesapla first.",
        "gecmis": "**Past records for {user}:**\n",
        "veri": "- ğŸš— Car: {araba} km\n- ğŸ’¡ Electricity: {elektrik} kWh\n- ğŸš¿ Water: {su} L\n- ğŸ¥© Meat: {et} g\nğŸ“… {tarih}",
        "karsilastirma_yok": "You need at least 2 records to compare. Use !hesapla to add data.",
        "karsilastirma": "**Comparison of last two records:**\nâ€¢ Old: {eski} â€” {eski_karbon:.2f} kg COâ‚‚/year\nâ€¢ New: {yeni} â€” {yeni_karbon:.2f} kg COâ‚‚/year\n\n{durum}",
        "durumlar": [
            "Your footprint hasn't changed.",
            "Your footprint **increased**! (+{fark:.2f} kg COâ‚‚)",
            "Your footprint **decreased**! ({fark:.2f} kg COâ‚‚ saved)"
        ],
        "temizlendi": "All your data has been deleted.",
        "dil_degisti": "Language switched to English.",
        "gecersiz": "Please enter a valid number.",
        "tablo": "**Command** | **Description**\n--- | ---\n!tanitim | Introduces the bot creator\n!dil en/tr | Changes the bot language\n!hesapla | Takes your daily data and calculates carbon footprint\n!geÃ§miÅŸ | Shows previous records\n!karÅŸÄ±laÅŸtÄ±r | Compares last two records\n!temizle | Deletes all your data\n!komutlar | Shows command list"
    }
}

def karbon_hesapla(araba, elektrik, su, et):
    araba_karbon = araba * 0.21
    elektrik_karbon = elektrik * 0.5
    su_karbon = su * 0.0003
    et_karbon = et * 0.027
    gunluk = araba_karbon + elektrik_karbon + su_karbon + et_karbon
    return gunluk * 365

@bot.event
async def on_ready():
    print(f"{bot.user} olarak giriÅŸ yapÄ±ldÄ±!")

@bot.command()
async def tanitim(ctx):
    dil = dil_tercihi.get(ctx.author.id, "tr")
    await ctx.send(mesajlar[dil]["tanitim"])

@bot.command()
async def dil(ctx, secim=None):
    if secim is None or secim.lower() not in ["tr", "en"]:
        await ctx.send("LÃ¼tfen geÃ§erli bir dil seÃ§in: en veya tr")
        return
    dil_tercihi[ctx.author.id] = secim.lower()
    await ctx.send(mesajlar[secim.lower()]["dil_degisti"])

@bot.command()
async def hesapla(ctx):
    dil = dil_tercihi.get(ctx.author.id, "tr")
    kullanici_durumlari[ctx.author.id] = 0
    if ctx.author.id not in user_data:
        user_data[ctx.author.id] = []
    user_data[ctx.author.id].append({})
    await ctx.send(mesajlar[dil]["sorular"][0])

@bot.command()
async def geÃ§miÅŸ(ctx):
    dil = dil_tercihi.get(ctx.author.id, "tr")
    kayitlar = user_data.get(ctx.author.id, [])
    if not kayitlar:
        await ctx.send(mesajlar[dil]["kayit_yok"])
        return
    mesaj = mesajlar[dil]["gecmis"].format(user=ctx.author.name)
    for k in kayitlar:
        mesaj += mesajlar[dil]["veri"].format(
            araba=k.get("araba", "?"),
            elektrik=k.get("elektrik", "?"),
            su=k.get("su", "?"),
            et=k.get("et", "?"),
            tarih=k.get("tarih", "?")
        ) + "\n"
    await ctx.send(mesaj)

@bot.command()
async def karÅŸÄ±laÅŸtÄ±r(ctx):
    dil = dil_tercihi.get(ctx.author.id, "tr")
    kayitlar = user_data.get(ctx.author.id, [])
    if len(kayitlar) < 2:
        await ctx.send(mesajlar[dil]["karsilastirma_yok"])
        return
    eski = kayitlar[-2]
    yeni = kayitlar[-1]
    eski_karbon = karbon_hesapla(eski.get("araba",0), eski.get("elektrik",0), eski.get("su",0), eski.get("et",0))
    yeni_karbon = karbon_hesapla(yeni.get("araba",0), yeni.get("elektrik",0), yeni.get("su",0), yeni.get("et",0))
    fark = yeni_karbon - eski_karbon
    if abs(fark) < 0.01:
        durum = mesajlar[dil]["durumlar"][0]
    elif fark > 0:
        durum = mesajlar[dil]["durumlar"][1].format(fark=fark)
    else:
        durum = mesajlar[dil]["durumlar"][2].format(fark=abs(fark))
    mesaj = mesajlar[dil]["karsilastirma"].format(
        eski=eski["tarih"],
        yeni=yeni["tarih"],
        eski_karbon=eski_karbon,
        yeni_karbon=yeni_karbon,
        durum=durum
    )
    await ctx.send(mesaj)

@bot.command()
async def temizle(ctx):
    dil = dil_tercihi.get(ctx.author.id, "tr")
    if ctx.author.id in user_data:
        del user_data[ctx.author.id]
    await ctx.send(mesajlar[dil]["temizlendi"])

@bot.command()
async def komutlar(ctx):
    dil = dil_tercihi.get(ctx.author.id, "tr")
    await ctx.send(mesajlar[dil]["tablo"])

@bot.event
async def on_message(message):
    if message.author.bot:
        return
    await bot.process_commands(message)

    user_id = message.author.id
    dil = dil_tercihi.get(user_id, "tr")
    if user_id not in kullanici_durumlari or kullanici_durumlari[user_id] == -1:
        return

    durum = kullanici_durumlari[user_id]
    try:
        veri = float(message.content.replace(",", "."))
    except ValueError:
        if durum in [0,1,2,3]:
            await message.channel.send(mesajlar[dil]["gecersiz"])
        return

    if durum == 0:
        user_data[user_id][-1]["araba"] = veri
        kullanici_durumlari[user_id] = 1
        await message.channel.send(mesajlar[dil]["sorular"][1])
    elif durum == 1:
        user_data[user_id][-1]["elektrik"] = veri
        kullanici_durumlari[user_id] = 2
        await message.channel.send(mesajlar[dil]["sorular"][2])
    elif durum == 2:
        user_data[user_id][-1]["su"] = veri
        kullanici_durumlari[user_id] = 3
        await message.channel.send(mesajlar[dil]["sorular"][3])
    elif durum == 3:
        user_data[user_id][-1]["et"] = veri
        user_data[user_id][-1]["tarih"] = datetime.now().strftime("%d.%m.%Y %H:%M")
        kullanici_durumlari[user_id] = -1

        karbon = karbon_hesapla(
            user_data[user_id][-1]["araba"],
            user_data[user_id][-1]["elektrik"],
            user_data[user_id][-1]["su"],
            user_data[user_id][-1]["et"],
        )

        if karbon < 3000:
            yorum = mesajlar[dil]["yorumlar"][0]
        elif karbon < 6000:
            yorum = mesajlar[dil]["yorumlar"][1]
        else:
            yorum = mesajlar[dil]["yorumlar"][2]

        sonuc = mesajlar[dil]["sonuc"].format(karbon=karbon, yorum=yorum)
        await message.channel.send(sonuc)

bot.run("  ")


